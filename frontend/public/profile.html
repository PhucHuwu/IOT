<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thông tin cá nhân - IOT Dashboard</title>
    <link rel="stylesheet" href="../src/styles/main.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>

<body>
    <div class="container">
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>Taskbar</h2>
            </div>

            <nav class="nav-menu">
                <a href="home-page.html" class="nav-item">
                    <i class="fas fa-home"></i>
                    <span>Trang chủ</span>
                </a>
                <a href="sensor-data.html" class="nav-item">
                    <i class="fas fa-chart-line"></i>
                    <span>Dữ liệu cảm biến</span>
                </a>
                <a href="action-history.html" class="nav-item">
                    <i class="fas fa-history"></i>
                    <span>Lịch sử hoạt động</span>
                </a>
            </nav>
        </div>

        <div class="main-content">
            <div class="header">
                <div class="header-left">
                    <a href="home-page.html" class="back-button">
                        <i class="fas fa-arrow-left"></i>
                    </a>
                </div>
                <div class="header-center">
                </div>
                <div class="header-right">
                    <div class="notification">
                        <i class="fas fa-bell"></i>
                        <span class="badge">1</span>
                    </div>
                    <div class="profile">
                        <div class="avatar">P</div>
                    </div>
                </div>
            </div>

            <div class="content">
                <div class="page-title">
                    <h1>Thông tin cá nhân</h1>
                    <p>Thông tin chi tiết về người dùng</p>
                </div>

                <div class="profile-container">
                    <div class="profile-card">
                        <div class="profile-avatar-section">
                            <div class="profile-avatar-large">
                                <div class="avatar-image" id="profileAvatar">P</div>
                                <div class="avatar-status"></div>
                            </div>
                            <button class="change-avatar-btn" onclick="openAvatarModal()">
                                <i class="fas fa-camera"></i>
                                Thay đổi ảnh đại diện
                            </button>
                            <input type="file" id="avatarInput" accept="image/*" style="display: none;"
                                onchange="previewAvatar(event)">
                        </div>

                        <div class="profile-info">
                            <div class="info-group">
                                <label class="info-label">
                                    <i class="fas fa-user"></i>
                                    Họ và tên
                                </label>
                                <div class="info-value">Trần Hữu Phúc</div>
                            </div>

                            <div class="info-group">
                                <label class="info-label">
                                    <i class="fas fa-id-card"></i>
                                    Mã sinh viên
                                </label>
                                <div class="info-value">B22DCCN634</div>
                            </div>

                            <div class="info-group">
                                <label class="info-label">
                                    <i class="fas fa-envelope"></i>
                                    Email
                                </label>
                                <div class="info-value">Phuctranhuu37@gmail.com</div>
                            </div>

                            <div class="info-group">
                                <label class="info-label">
                                    <i class="fas fa-graduation-cap"></i>
                                    Khoa
                                </label>
                                <div class="info-value">Công nghệ thông tin</div>
                            </div>

                            <div class="info-group">
                                <label class="info-label">
                                    <i class="fab fa-github"></i>
                                    GitHub
                                </label>
                                <div class="info-value link-value">
                                    <a href="https://github.com/PhucHuwu" target="_blank" rel="noopener noreferrer">
                                        github.com/PhucHuwu
                                        <i class="fas fa-external-link-alt"></i>
                                    </a>
                                </div>
                            </div>

                            <div class="info-group">
                                <label class="info-label">
                                    <i class="fab fa-figma"></i>
                                    Figma
                                </label>
                                <div class="info-value link-value">
                                    <a href="https://www.figma.com/community/file/1543700896847257072/iot-figma"
                                        target="_blank" rel="noopener noreferrer">
                                        figma.com/iot-figma
                                        <i class="fas fa-external-link-alt"></i>
                                    </a>
                                </div>
                            </div>

                            <div class="info-group">
                                <label class="info-label">
                                    <i class="fas fa-briefcase"></i>
                                    Portfolio
                                </label>
                                <div class="info-value link-value">
                                    <a href="https://phuchuwu.vercel.app/" target="_blank" rel="noopener noreferrer">
                                        phuchuwu.vercel.app
                                        <i class="fas fa-external-link-alt"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal-overlay" id="avatarModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i class="fas fa-camera"></i> Cập nhật ảnh đại diện</h3>
                    <button class="close-btn" onclick="closeAvatarModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="avatar-preview-section">
                        <div class="current-avatar">
                            <h4>Ảnh hiện tại</h4>
                            <div class="preview-avatar current" id="currentAvatarPreview">G</div>
                        </div>
                        <div class="new-avatar" id="newAvatarSection" style="display: none;">
                            <h4>Ảnh mới</h4>
                            <div class="preview-avatar new" id="newAvatarPreview"></div>
                        </div>
                    </div>

                    <div class="upload-section">
                        <div class="upload-area" onclick="triggerFileInput()">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Nhấn để chọn ảnh</p>
                            <span>Hỗ trợ: JPG, PNG, GIF (Tối đa 5MB)</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-secondary" onclick="closeAvatarModal()">Hủy</button>
                    <button class="btn-primary" onclick="updateAvatar()" id="updateBtn" disabled>Cập nhật</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Avatar update functionality
        let selectedAvatarType = null;
        let selectedAvatarData = null;

        function openAvatarModal() {
            document.getElementById('avatarModal').style.display = 'flex';
            document.body.style.overflow = 'hidden';

            // Reset modal state
            document.getElementById('newAvatarSection').style.display = 'none';
            document.getElementById('updateBtn').disabled = true;
            selectedAvatarType = null;
            selectedAvatarData = null;
        }

        function closeAvatarModal() {
            document.getElementById('avatarModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function triggerFileInput() {
            document.getElementById('avatarInput').click();
        }

        function previewAvatar(event) {
            const file = event.target.files[0];
            if (file) {
                // Check file size (5MB limit)
                if (file.size > 5 * 1024 * 1024) {
                    alert('Kích thước file quá lớn. Vui lòng chọn file nhỏ hơn 5MB.');
                    return;
                }

                // Check file type
                if (!file.type.match('image.*')) {
                    alert('Vui lòng chọn file ảnh hợp lệ.');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function (e) {
                    const newAvatarPreview = document.getElementById('newAvatarPreview');
                    newAvatarPreview.style.backgroundImage = `url(${e.target.result})`;
                    newAvatarPreview.style.backgroundSize = 'cover';
                    newAvatarPreview.style.backgroundPosition = 'center';
                    newAvatarPreview.innerHTML = '';

                    document.getElementById('newAvatarSection').style.display = 'block';
                    document.getElementById('updateBtn').disabled = false;

                    selectedAvatarType = 'image';
                    selectedAvatarData = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        function selectPresetAvatar(avatar) {
            // Remove active class from all preset avatars
            document.querySelectorAll('.preset-avatar').forEach(el => {
                el.classList.remove('active');
            });

            // Add active class to selected avatar
            event.target.classList.add('active');

            const newAvatarPreview = document.getElementById('newAvatarPreview');
            newAvatarPreview.style.backgroundImage = 'none';
            newAvatarPreview.innerHTML = avatar;
            newAvatarPreview.style.fontSize = '48px';

            document.getElementById('newAvatarSection').style.display = 'block';
            document.getElementById('updateBtn').disabled = false;

            selectedAvatarType = 'preset';
            selectedAvatarData = avatar;
        }

        function updateAvatar() {
            if (!selectedAvatarType || !selectedAvatarData) {
                alert('Vui lòng chọn ảnh đại diện mới.');
                return;
            }

            // Sử dụng AvatarManager để cập nhật avatar
            if (window.avatarManager) {
                window.avatarManager.saveAvatar(selectedAvatarType, selectedAvatarData);
            } else {
                // Fallback nếu AvatarManager chưa load
                if (selectedAvatarType === 'image') {
                    localStorage.setItem('userAvatarType', 'image');
                    localStorage.setItem('userAvatarData', selectedAvatarData);
                } else if (selectedAvatarType === 'preset') {
                    localStorage.setItem('userAvatarType', 'preset');
                    localStorage.setItem('userAvatarData', selectedAvatarData);
                }

                // Manual update cho trang hiện tại
                const profileAvatar = document.getElementById('profileAvatar');
                const headerAvatar = document.querySelector('.header-right .avatar');

                if (selectedAvatarType === 'image') {
                    profileAvatar.style.backgroundImage = `url(${selectedAvatarData})`;
                    profileAvatar.style.backgroundSize = 'cover';
                    profileAvatar.style.backgroundPosition = 'center';
                    profileAvatar.innerHTML = '';

                    headerAvatar.style.backgroundImage = `url(${selectedAvatarData})`;
                    headerAvatar.style.backgroundSize = 'cover';
                    headerAvatar.style.backgroundPosition = 'center';
                    headerAvatar.innerHTML = '';
                } else if (selectedAvatarType === 'preset') {
                    profileAvatar.style.backgroundImage = 'none';
                    profileAvatar.innerHTML = selectedAvatarData;
                    profileAvatar.style.fontSize = '48px';

                    headerAvatar.style.backgroundImage = 'none';
                    headerAvatar.innerHTML = selectedAvatarData;
                    headerAvatar.style.fontSize = '16px';
                }
            }

            // Show success message
            showNotification('Cập nhật ảnh đại diện thành công!', 'success');

            // Close modal
            closeAvatarModal();
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;

            document.body.appendChild(notification);

            // Show notification
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);

            // Hide notification after 3 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Load saved avatar on page load
        function loadSavedAvatar() {
            // AvatarManager sẽ tự động load avatar, không cần function này nữa
            // Tuy nhiên giữ lại để backward compatibility
            if (window.avatarManager) {
                window.avatarManager.loadSavedAvatar();
            } else {
                // Fallback code
                const avatarType = localStorage.getItem('userAvatarType');
                const avatarData = localStorage.getItem('userAvatarData');

                if (avatarType && avatarData) {
                    const profileAvatar = document.getElementById('profileAvatar');
                    const headerAvatar = document.querySelector('.header-right .avatar');

                    if (avatarType === 'image') {
                        profileAvatar.style.backgroundImage = `url(${avatarData})`;
                        profileAvatar.style.backgroundSize = 'cover';
                        profileAvatar.style.backgroundPosition = 'center';
                        profileAvatar.innerHTML = '';

                        headerAvatar.style.backgroundImage = `url(${avatarData})`;
                        headerAvatar.style.backgroundSize = 'cover';
                        headerAvatar.style.backgroundPosition = 'center';
                        headerAvatar.innerHTML = '';
                    } else if (avatarType === 'preset') {
                        profileAvatar.style.backgroundImage = 'none';
                        profileAvatar.innerHTML = avatarData;

                        headerAvatar.style.backgroundImage = 'none';
                        headerAvatar.innerHTML = avatarData;
                    }
                }
            }
        }

        // Initialize avatar on page load
        document.addEventListener('DOMContentLoaded', function () {
            loadSavedAvatar();
        });

        // Close modal when clicking outside
        document.getElementById('avatarModal').addEventListener('click', function (e) {
            if (e.target === this) {
                closeAvatarModal();
            }
        });

        // Handle drag and drop
        const uploadArea = document.querySelector('.upload-area');

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            uploadArea.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, unhighlight, false);
        });

        function highlight(e) {
            uploadArea.classList.add('drag-over');
        }

        function unhighlight(e) {
            uploadArea.classList.remove('drag-over');
        }

        uploadArea.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;

            if (files.length > 0) {
                const file = files[0];
                const event = { target: { files: [file] } };
                previewAvatar(event);
            }
        }
    </script>
</body>

</html>